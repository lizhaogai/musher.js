/***********************************************
* Musher Javascript and Node.js Library v0.0.2
* https://github.com/taoyuan/musher
* 
* Copyright (c) 2014 Tao Yuan.
* Licensed MIT 
* 
* Date: 2014-06-15 10:17
***********************************************/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.musher=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c){!function(a){"use strict";a(function(){function a(a,c){function d(){a._connected()}var e=a.settings||{},f=Number(e.port||1883),g=e.host||"127.0.0.1",h=e.clientId||c.makeId(),i=a.client=new Messaging.Client(g,f,h);i.onConnectionLost=function(){a._disconnected()},i.onMessageArrived=function(b){a._message(b.destinationName,b.payloadString)};var j=c.assign({onSuccess:d},e.options);i.connect(j),a.adapter=new b(i)}function b(a){this.client=a}return b.prototype.subscribe=function(a,b,c){var d=b||{};return c&&(d.onSuccess=c),this.client.subscribe(a,d)},b.prototype.unsubscribe=function(a,b,c){var d=b||{};return c&&(d.onSuccess=c),this.client.unsubscribe(a,d)},b.prototype.publish=function(a,b){var c=new Messaging.Message(b);return c.destinationName=a,this.client.send(c)},b.prototype.close=function(){return this.client.disconnect()},{initialize:a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{}],2:[function(b,c){!function(a){"use strict";a(function(a){function b(a,c,d){return this instanceof b?(this.socket=d,this.key=d.key,this.adapter=d.adapter,this.name=a,this.options=c,void(this.topic=d._encode(this.name))):new b(a,c,d)}var c=a("./emitter");return c.extend(b),b.prototype.bind=b.prototype.on,b.prototype.subscribe=function(a){var b=this;return this.adapter.subscribe(this.topic,this.options,function(c){a&&a.call(b,c,b)}),this},b.prototype.unsubscribe=function(a){return this.adapter.unsubscribe(this.topic,{},a),this},b.prototype.__handleMessage=function(a){a=JSON.parse(a),a.__event__&&a.__data__&&this.emit(a.__event__,a.__data__)},b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./emitter":5}],3:[function(b,c){!function(a){"use strict";a(function(a){function b(a){this.socket=a,this.key=a.key,this.adapter=a.adapter,this._channels={}}function c(a,b,c){return new d(a,b,c)}var d=a("./channel"),e=a("./utils");return b.prototype.add=function(a,b,d){return e.sure(this._channels,a,function(){return c(a,b,d)})},b.prototype.remove=function(a){var b=this._channels[a];return delete this._channels[a],b},b.prototype.channel=function(a){return this._channels[this.socket._decode(a)]},b.prototype.unsubscribeAll=function(a){if(!this.channels)return a();var b=[];return e.each(this.channels,function(a){b.push(a.unsubscribe.bind(a))}),e.parallel(b,a)},b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./channel":2,"./utils":7}],4:[function(b,c){!function(a){"use strict";a(function(){return function(){return{host:"musher.ollo.io"}}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{}],5:[function(b,c){!function(a){"use strict";a(function(a){function b(){}var c=a("./utils");return b.mixin=function(a){return c.assign(a,b.prototype),a},b.extend=function(a){return c.assign(a.prototype,b.prototype),a},b.prototype.on=b.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},b.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},b.prototype.off=b.prototype.removeListener=b.prototype.removeAllListeners=b.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},b.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},b.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},b.prototype.hasListeners=function(a){return!!this.listeners(a).length},b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./utils":7}],6:[function(b,c){!function(a){"use strict";a(function(a){function b(a,d){if(!(this instanceof b))return new b(a,d);var g=this;if(this.settings=d=c.assign({},f,d),this.key=d.key,this.topicKey=this.key?"$"+this.key+":":null,d.options=d.options||{},c.parseAuthOptions(d,d.options),this.queue=[],a.initialize(g,c),!g.adapter)throw new Error("Adapter is not defined correctly: it should create `adapter` member of socket");g.channels=new e(this)}var c=a("./utils"),d=a("./emitter"),e=a("./channels"),f=a("./defaults")();return d.extend(b),b.prototype._connected=function(){this.connected=!0;for(var a=0;a<this.queue.length;a++)this.queue[a]();this.queue=[],this.emit("connected")},b.prototype._disconnected=function(){this.connected=!1,this.emit("disconnected")},b.prototype._enqueue=function(a){this.queue.push(a)},b.prototype._message=function(a,b){var c=this.channel(a);if(!c)throw new Error("No channel to handle message with topic ["+a+"]");c.__handleMessage(b)},b.prototype._encode=function(a){return this.topicKey&&0!=a.indexOf(this.topicKey)?this.topicKey+a:a},b.prototype._decode=function(a){return this.topicKey&&0==a.indexOf(this.topicKey)?a.substring(this.topicKey.length):a},b.prototype.close=function(a){a&&this.once("disconnected",a),this.adapter.close()},b.prototype.channel=function(a){return this.channels.channel(a)},b.prototype.subscribe=function(a,b,c){"function"==typeof b&&(c=b,b=null);var d=this.channels.add(a,b,this);return d.connected?d.subscribe(c):this._enqueue(function(){d.subscribe(c)}),d},b.prototype.unsubscribe=function(a,b){b=b||c.nop;var d=this.channels.remove(a,b);return d.connected?d.unsubscribe(b):b(),this},b.prototype.publish=function(a,b,c){var d=this;return d.connected?d._publish(a,b,c):this._enqueue(function(){d._publish(a,b,c)}),this},b.prototype._publish=function(a,b,c){var d=JSON.stringify({__event__:b,__data__:c});this.adapter.publish(this._encode(a),d)},b.defaults=function(a){c.assign(f,a)},b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./channels":3,"./defaults":4,"./emitter":5,"./utils":7}],7:[function(b,c){!function(a){"use strict";a(function(){function a(){}function b(a,b,c){if(null!=a)if(j&&a.forEach===j)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===h)return}else for(var f=a.keys,d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)===h)return}function c(a){return b(k.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a}function d(a,b){var c=[],d=a.length;a.forEach(function(a,e){a(function(a,f){c[e]=f,a&&(b(a),b=null),0===--d&&b&&b(null,c)})})}function e(a,b,c){var d=a[b];return d?d:a[b]="function"==typeof c?c.call(a):c}function f(a){var b,c,d;for(d="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=0;5>b;b++)d+=c.charAt(Math.floor(Math.random()*c.length));return(a?a:"musher-")+d}function g(a,b){a&&(a.key&&(b.username=a.key),a.secret&&(b.password=a.secret))}var h={},i=Array.prototype,j=i.forEach,k=i.slice;return{nop:a,each:b,forEach:b,assign:c,parallel:d,sure:e,makeId:f,parseAuthOptions:g}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{}],8:[function(a,b,c){var d=a("../lib/socket");d.defaults({host:"sock.musher.im",port:3883}),c.utils=a("../lib/utils"),c.connect=function(b,c){return"object"==typeof b&&(c=b,b=null),c=c||{},b&&(c.key=b),new d(a("../lib/adapters/paho"),c)},c.Socket=d},{"../lib/adapters/paho":1,"../lib/socket":6,"../lib/utils":7}]},{},[8])(8)});